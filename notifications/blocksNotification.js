import{a as Tt,b as kt}from"../chunks/chunk-KL54U6NQ.js";import{a as wt}from"../chunks/chunk-O2KE44VO.js";import{a as st,b as lt,c as mt,d as dt,e as ft,f as pt,i as S,j as _t}from"../chunks/chunk-W5ULS3YS.js";import{m as at}from"../chunks/chunk-GXARYUH5.js";import{c as O,d as me,g as ct,h as Oe}from"../chunks/chunk-7VR4VJF6.js";import{b as ut}from"../chunks/chunk-2LNQ42WD.js";import{a as gt,b as Et,c as Ct}from"../chunks/chunk-IABBK5OK.js";import"../chunks/chunk-AHW6BBB4.js";import"../chunks/chunk-XXVKPEZT.js";import"../chunks/chunk-NCANGEQT.js";import{i as et,k as tt,s as it}from"../chunks/chunk-B7TRBNR3.js";import{b as K}from"../chunks/chunk-TY2WWATK.js";import{a as ot}from"../chunks/chunk-QCPV2SDO.js";import"../chunks/chunk-H45DLGCI.js";import"../chunks/chunk-MYY6QNB4.js";import"../chunks/chunk-WCQV4SF3.js";import"../chunks/chunk-X2IWIW6K.js";import{a as rt,b as se,c as nt,d as ce,e as le}from"../chunks/chunk-JFLVCXPX.js";import"../chunks/chunk-DWQLULSJ.js";import{a as ht}from"../chunks/chunk-IUMQMMIE.js";import{a as Ze}from"../chunks/chunk-M25S27FE.js";import{c as Kt}from"../chunks/chunk-NGB4QQHI.js";import{b as Lt}from"../chunks/chunk-XEYZDI33.js";import"../chunks/chunk-J7QHBV67.js";import{b as Fe,d as ee,e as Me,g as b,h as P,i as Be}from"../chunks/chunk-VGEMM5MB.js";import"../chunks/chunk-JDV5FZKX.js";import"../chunks/chunk-2JQDE4PE.js";import{a as Ve,b as We,c as re}from"../chunks/chunk-FMNBUMJ5.js";import"../chunks/chunk-IYAFYZRF.js";import{a as He}from"../chunks/chunk-CXSZXIOJ.js";import{a as ne,b as X,e as ie}from"../chunks/chunk-QLZPWOED.js";import{b as qe,d as Je,e as z,t as Ye,u as Xe,v as Qe,w as je}from"../chunks/chunk-OCTA2RVM.js";import"../chunks/chunk-YQ5KARKK.js";import"../chunks/chunk-DKGSS5NA.js";import"../chunks/chunk-F2BE3OL5.js";import{a as $e}from"../chunks/chunk-IJEQYNEP.js";import{a as Ge}from"../chunks/chunk-TFT336KV.js";import"../chunks/chunk-TYA5STFG.js";import{c as Ke,q as ae}from"../chunks/chunk-4MWWZMVF.js";import{c as Ht,h as m,j as Y,k as te,n as l,o as g,t as ze,v as oe}from"../chunks/chunk-2WJMAHXV.js";import{a as Ue,d as zt}from"../chunks/chunk-W7K6NY26.js";import"../chunks/chunk-QWQLNDJC.js";import"../chunks/chunk-WRIUWJSJ.js";import{F as Le,G as v,H as I,I as ve,z as J}from"../chunks/chunk-4MSTBY6L.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{e as Ie}from"../chunks/chunk-C4QCPH6A.js";import{d as Ae,f as Bt}from"../chunks/chunk-ZRHTGYWI.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-J5H5CHL2.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as d}from"../chunks/chunk-3GYLW4KZ.js";var Pe=d(Lt());Fe();Kt();var H=d(J());Be();var yt=d(v()),Gt=async()=>{let e=We("postcheckout-email-create-account-block-notification"),t=await re(e),o={rootEl:"div",logLevel:null},r=await le(),n={merchantName:r.host.merchant??""};return{config:o,content:t,data:n,...r}},Ot=({onUnload:e})=>{let[t,o]=(0,H.useState)(),r=(0,H.useCallback)(async n=>{switch(n.type){case X.Destroy:e?.(),m.set(P.treeVisible,!1);break;case X.NotificationShow:g("track",P.metric,{action:"seen"});break;case X.NotificationDismiss:await K({message:ee.dismiss}),g("track",P.metric,{action:"dismissed"}),m.set(P.treeVisible,!1);break;case X.Custom:n.eventName==="onCreateAccountClick"?(await K({message:ee.clickedCreateAccount}),g("track",P.metric,{action:"clicked"})):n.eventName==="onSignInClick"&&(await K({message:ee.clickedSignIn}),g("track",P.metric,{action:"signIn"})),m.set(P.treeVisible,!1),e?.();break}},[e]);return(0,H.useEffect)(()=>{Gt().then(n=>{o(n),m.set(P.treeVisible,!0)}).catch(console.error)},[]),t?(0,yt.jsx)(ie,{client:ne.DESKTOP_WEB,config:t.config,content:t.content,data:t.data,user:t.user,onEvent:r,onRequest:ce}):null};var St=async()=>oe("getElasticityUserData");var xt=()=>oe("getPostCheckoutExcludedDomains");ve();var de=d($e()),ye=d(v());function fe({visible:e,disabled:t=!1,animFinished:o=()=>{},children:r}){return(0,ye.jsx)(de.Motion,{onRest:o,defaultStyle:{opacity:0},style:{opacity:t?1:(0,de.spring)(e?1:0,{stiffness:220,damping:20})},children:({opacity:n})=>(0,ye.jsx)("div",{style:{opacity:n,overflow:"hidden"},children:r})})}var G=d(J()),ue=d($e()),pe=d(v());function he({disabled:e,expanded:t,animFinished:o,children:r}){let[n,i]=(0,G.useState)(0),a=(0,G.useRef)(null);return(0,G.useEffect)(()=>{a.current&&i(a.current.scrollHeight)},[]),(0,pe.jsx)(ue.Motion,{onRest:o,style:{height:e?n:(0,ue.spring)(t?n:0,{stiffness:220,damping:50,precision:4})},children:({height:s})=>(0,pe.jsx)("div",{style:{height:s,overflow:"hidden"},children:(0,pe.jsx)("div",{ref:a,children:r})})})}var R=d(J()),bt=d(Ht());ve();zt();var Se="postcheckout_modal_retargeting";function _e(){rt(Se)}function ge(e,t){let o="postCheckoutRetargeting",{getValue:r,getRichText:n}=Le("Post_Checkout_Amazon_Notif"),[i,a]=(0,R.useState)([]),s=(0,R.useMemo)(()=>i.map(p=>p.tld),[i]),C=(0,R.useMemo)(()=>i.some(p=>p.stats.rewardType==="threshold"),[i]),[x,E]=(0,R.useState)(!1),[T,k]=(0,R.useState)(!0),[F,A]=(0,R.useState)(!1),w=l("ext_pcm_amazon_animate"),U=2;function Te(p,D){let u=[...D].sort((y,L)=>{let B=p?.[y.tld]||0,Z=p?.[L.tld]||0;return B-Z}).reduce((y,L,B)=>(y[L.tld]=B,y),{});return D.filter(y=>u[y.tld]<4)}return(0,R.useEffect)(()=>{async function p(){try{let D=m.get(["siteAPIData","tld"])||"",M=l("ext_pcm_new_offers"),u=await mt(M?"newOffers":"recommended",D);u?.items?.length?u.items.length<U?(O("amazonMinOfferMiss"),g("page",o,{view:`amazon_pc_min_offer_miss_${U}`,meta:JSON.stringify({offers:u})})):(M?(u.items=Te(u.seenOffers,u.items)||[],u.items.forEach(f=>{lt({tld:f.tld})})):u.items=u.items.slice(0,4),u.items.forEach(f=>{O("amazonOffer",[`tld:${Oe(f.tld)}`])}),O("amazonShown",[`type:${e}`]),g("page",o,{view:"amazon_pc_shown",meta:JSON.stringify({offers:u})}),a(u.items)):(O("amazonNoOffersAvailable"),g("page",o,{view:"amazon_pc_no_offers_available"})),me("amazonFinish",t)}catch(D){O("amazonError",[`type:${e}`]),console.error(D)}}p()},[]),{getValue:r,getRichText:n,showOffers:i,hasThresholdOffer:C,domains:s,hidden:x,showingOfferPanel:T,wrapperWasAnimated:F,hasAnimation:w,notifHidden:()=>{O("amazonNotifDismissed",[`type:${e}`]),_e(),w?k(!1):E(!0)},clickOffer:(p,D)=>{let M={redirect:!0,cashback:!!p.stats.cashback,meta:JSON.stringify({index:D,cashback:p.stats.cashback,triggerType:"amazonEmbedded",merchantName:p.merchantName,dealsLength:i.length})};O("amazonClickOffer",[`tld:${Oe(p.tld)}`,`type:${e}`]),et(o,"amazon_offer_clicked","cta","primary",M);let u=p.href;if(p.hrefV3){let f=(0,bt.v4)();u=Ue(p.hrefV3,{subExperience:"post_checkout",redirectId:f,clickEvent:"postCheckoutClick_ama_e"})}window.open(u,"_blank","noopener noreferrer")},wrapperAnimFinished:()=>{T?A(!0):E(!0)},MIN_OFFER_REQUIREMENT:U,setHidden:E,setShowingOfferPanel:k,setWrapperWasAnimated:A,termsClick:()=>{at(s)}}}var h=d(v());function xe({type:e,startTime:t,centered:o=!1}){let{getValue:r,getRichText:n,showOffers:i,domains:a,hidden:s,showingOfferPanel:C,wrapperWasAnimated:x,hasAnimation:E,notifHidden:T,clickOffer:k,wrapperAnimFinished:F,MIN_OFFER_REQUIREMENT:A}=ge(e,t);return i.length<A||s?null:(0,h.jsx)(he,{disabled:!E,expanded:C,animFinished:F,children:(0,h.jsx)("div",{className:z(["flex flex-col py-4",!o&&"float-left"]),children:(0,h.jsx)(Tt,{getValue:r,onHideNotif:T,wrapperClass:z(["min-w-[600px] max-w-full",o?"mx-auto":""]),domains:a,backgroundColor:r("containerBgColor"),disableDarkMode:!0,showTitleSeparator:!1,showInfoIconForExclusions:!0,children:(0,h.jsx)("div",{className:"overflow-hidden overflow-x-scroll",children:(0,h.jsx)(fe,{disabled:!E,visible:x,children:(0,h.jsx)("div",{className:"flex flex-row align-start space-x-4 p-2",children:i.map((w,U)=>(0,h.jsxs)("div",{className:"flex flex-col justify-start items-center border-solid border border-border min-w-[192px] bg-white cursor-pointer hover:outline hover:outline-[3px] hover:outline-blue-500",onClick:()=>k(w,U),children:[(0,h.jsx)("div",{className:"flex items-center justify-center w-full bg-white",children:(0,h.jsx)("div",{className:"flex items-center justify-center w-[150px] h-[118px]",children:(0,h.jsx)("img",{className:"max-w-full max-h-full object-contain",src:w.primaryImage})})}),(0,h.jsxs)("div",{className:"w-full text-base self-start space-y border-solid border-t border-gray-150 p-2",children:[(0,h.jsxs)("div",{children:[w.stats.rewardType==="threshold"&&w.stats?.rewardTiers&&(0,h.jsx)(I,{items:n({itemName:"threshold_reward_text",parseValues:{threshold:w.stats?.rewardTiers[0].displaySpendCents,threshold_reward:w.stats?.rewardTiers[0]?.reward?.displayValue}})}),w.stats.rewardType!=="threshold"&&(0,h.jsx)(I,{items:n({itemName:w.stats.isCutType?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:w.stats.cashbackV2}})})]}),(0,h.jsx)("div",{className:"max-w-[142px] line-clamp-1",children:(0,h.jsx)(I,{items:n({itemName:"description",parseValues:{merchant:w.merchantName}})})})]})]},U))})})})})})})}var Q=d(J());ve();var c=d(v());function be({type:e,opBox:t,adBox:o,container:r,startTime:n,centered:i=!1}){let{getValue:a,getRichText:s,showOffers:C,hasThresholdOffer:x,hidden:E,setHidden:T,showingOfferPanel:k,wrapperWasAnimated:F,hasAnimation:A,notifHidden:w,clickOffer:U,wrapperAnimFinished:Te,termsClick:De,MIN_OFFER_REQUIREMENT:ke}=ge(e,n),Re=kt(),j=(0,Q.useRef)(),p=(0,Q.useRef)();function D(){let f=window.getComputedStyle(t),y=window.getComputedStyle(o),L=o.querySelector("div#BillboardWidget"),B=450;L&&(B=parseInt(window.getComputedStyle(L).width));let Z=parseInt(f.marginLeft)+parseInt(f.marginRight)+parseInt(y.marginLeft)+parseInt(y.marginRight),we=r.clientWidth-B-Z-(B-20),Mt=r.clientWidth-(we<285?285:we)-435-Z;t.style.width=`${Math.floor(we/r.clientWidth*100)}%`,t.style["min-width"]="285px",o.style.float="left",o.style.width=`${Mt}px`,o.style["padding-left"]="10px"}function M(){t.style=j.current,o.style=p.current}(0,Q.useEffect)(()=>{j.current===void 0&&(j.current=t.style,p.current=o.style),C.length>=ke&&!E&&(r.clientWidth<900?(M(),T(!0)):D())},[C,Re]);let u=()=>{k||M(),Te()};return C.length<ke||E?null:(0,c.jsx)(he,{disabled:!A,expanded:k,animFinished:u,children:(0,c.jsx)("div",{className:z(["w-[410px] border-solid border border-border mr-4",a("containerBgColor")]),children:(0,c.jsxs)("div",{className:"flex flex-col w-full p-4",children:[(0,c.jsxs)("div",{className:"flex flex-row w-full",children:[(0,c.jsx)(Ge,{showFullLogo:!0}),(0,c.jsx)("span",{className:"my-auto ml-auto",children:(0,c.jsx)(He,{width:25,height:25,small:!0,onClick:w})})]}),(0,c.jsxs)("span",{className:"text-lg font-semibold my-2 px-1",children:[a("title"),(0,c.jsx)(Ye,{children:(0,c.jsxs)(Xe,{delayDuration:150,children:[(0,c.jsx)(Qe,{className:"border-none outline-none shadow-none m-0 pt-1 pr-3 pb-1 pl-2 font-light italic min-w-0",children:(0,c.jsx)(Je,{className:"info-icon h-4 w-4"})}),(0,c.jsxs)(je,{side:"top",sideOffset:20,className:"font-light italic text-neutralsecondary",children:[a("info_tooltip_content")," ",(0,c.jsx)("span",{className:"italic underline cursor-pointer",onClick:De,children:a("info_tooltip_content_link_text")})]})]})})]}),(0,c.jsx)(fe,{disabled:!A,visible:F,children:(0,c.jsxs)("div",{className:"w-full px-1",children:[C.map((f,y)=>(0,c.jsxs)("div",{className:"flex flex-row w-full h-[80px] justify-start items-center cursor-pointer border border-solid border-gray-150 hover:outline hover:outline-[3px] hover:outline-blue-500 my-2 px-2 bg-white",onClick:()=>U(f,y),children:[(0,c.jsx)("div",{className:"flex items-center justify-center w-[60px] h-[48px] bg-white border border-white border-solid",children:(0,c.jsx)("img",{className:"max-w-full max-h-full object-contain",src:f.primaryImage})}),(0,c.jsxs)("div",{className:"flex flex-col flex-1 text-base ml-4 my-auto",children:[(0,c.jsx)(I,{items:s({itemName:"description",parseValues:{merchant:f.merchantName}})}),f.stats.rewardType==="threshold"&&f.stats?.rewardTiers&&(0,c.jsx)(I,{items:s({itemName:"threshold_reward_text",parseValues:{threshold:f.stats?.rewardTiers[0].displaySpendCents,threshold_reward:f.stats?.rewardTiers[0]?.reward?.displayValue}})}),f.stats.rewardType!=="threshold"&&(0,c.jsx)(I,{items:s({itemName:f.stats.isCutType?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:f.stats.cashbackV2}})})]}),(0,c.jsx)(qe,{className:z(["h-8 w-8 mr-2",a("offer_info_icon_color")])})]},y)),x&&(0,c.jsx)("div",{className:"mt-2",children:(0,c.jsx)(I,{items:s({itemName:"threshold_disclaimer"})})})]})})]})})})}var Ee=d(J()),V=d(Ie());var Pt=d(v());async function Vt(){let[e,t,o,r]=await Promise.all([ht(),Ze(),tt(),st()]);e&&(m.set("pageViewId",window.__wb_page_view_id),m.set("session",V.default.get(e,"session")),m.set("events",V.default.get(e,"settings.events")),m.set("settings",V.default.get(e,"settings")),m.set("tabId",V.default.get(e,"tabId")),m.set("lexiFetchResponse",V.default.get(e,"lexiFetchResponse"))),m.merge({siteAPIData:t}),m.merge({cashback:o}),m.set("referralsOffer",r)}async function Wt(){await Vt();let e=m.get("siteAPIData"),t=e?.siteData?.cashback?.reward||{},o=await chrome.storage.local.get("lastCouponSavings"),r=o?.lastCouponSavings,n=m.get("cashback"),i=m.get("referralsOffer"),a=Ve("post-checkout-referrals"),s=l("should_use_blocks_service")&&a?await re(a):void 0,C=s||await ut("desktopextension-postcheckout-referrals"),x={rootEl:"div",logLevel:null},E={senderBonus:i.senderBonus||0,maxReferralValue:i.maxReferralValue||0,referralLink:i.code?`${Ke}/${i.code}`:null,$savings:{couponSavings:r??0,cashbackActivated:!!n?.user?.activated,couponsActivated:r!=null},siteReward:t,couponSavings:o?.lastCouponSavings||0,throttleKey:"postcheckout_modal_referrals"},T=await le();return{config:x,content:C,data:E,...T}}function Ce({onUnload:e}){let[t,o]=(0,Ee.useState)();return(0,Ee.useEffect)(()=>{Wt().then(r=>o(r)).catch(console.error)},[]),t?(0,Pt.jsx)(ie,{client:ne.DESKTOP_WEB,config:t.config,content:t.content,host:t.host,user:t.user,data:t.data,onEvent:r=>{r.type==="sp-blocks-custom"&&r.eventName==="clickCopyLink"&&navigator.permissions.query({name:"clipboard-write"}).then(async n=>{if((n.state==="granted"||n.state==="prompt")&&t.data&&!(t.data instanceof Map)){let i=`https://${t.data.referralLink}`,a=`<a href="${i}">${i}</a>`;try{let s=new ClipboardItem({"text/html":new Blob([a],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})});await navigator.clipboard.write([s])}catch{await navigator.clipboard.writeText(i)}}}).catch(n=>{let i=typeof r.data?.label=="string"?r.data.label.trim():"";i.includes(".com")&&(i="referralLink"),g("trackError","referralsPcC2CError",i,{error:n instanceof Error?n.message:String(n)})}),nt(r,e)},onRequest:ce}):null}var Nt=d(Ie());Bt();Fe();Be();async function qt(){let e=await K({message:"getEvents"}),t=Nt.default.chain(e).pickBy(s=>new Date().valueOf()-new Date(s).valueOf()<2592e6).value(),o=b.clickedSignIn in t&&new Date().valueOf()-new Date(t[b.clickedSignIn]).valueOf()<864e5;if(b.clickedSignUp in t&&new Date().valueOf()-new Date(t[b.clickedSignUp]).valueOf()<864e5||o)return!0;let n=b.seenPostCheckoutCreateAccount1 in t&&b.seenPostCheckoutCreateAccount2 in t&&b.seenPostCheckoutCreateAccount3 in t,i=new Date(Math.max(new Date(t[b.seenPostCheckoutCreateAccount1]||0).valueOf(),new Date(t[b.seenPostCheckoutCreateAccount2]||0).valueOf(),new Date(t[b.seenPostCheckoutCreateAccount3]||0).valueOf())),a=i&&new Date().valueOf()-i.valueOf()<864e5;return!!(n||a)}async function Dt(){Ae("*** postCheckoutCreateAccount: evaluating...");let e=m.get(P.treeVisible);return ot()||e||await qt()?!1:Y(Me.enabled)}var _=d(v());window.__wb_timing.blocksNotifRequireAt=performance.now();var $;function q(){$?.()}function N(e=!0){e&&_e(),q()}var Yt="blocks_cross_device",Xt={throttleKey:Yt},Qt=["postcheckout_modal_dtm_xd_switch_","postcheckout_modal_dtm_xd_retarget_switch_"];function jt(){return Qt.some(Y)}var Rt=new Map([["amazon.com","ext_pcm_amz_check"]]);function It(e){return e==="amazon.com"&&l("ext_pcm_amazon_ec")}function Ft(e,t){return!e&&(!Ne()||!!t&&t.rate<=Ut())}function Zt(e){return Rt.has(e)?!l(Rt.get(e)):!0}function eo(e,t){return!!t&&t?.merchants[e]?.disabled}function to({startTime:e,dismissedNotifPastDay:t,createAccountThrottled:o,referralsThrottled:r,xSellThrottled:n,retargetingThrottled:i,userElasticity:a,retargetingExclusions:s,canShowRetargetingOnDomain:C}){let x=m.get("siteAPIData"),E=x?.tld||"";if(It(E)&&Ft(i,a))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:N,contentProps:{type:"recommended"},isSingleOffer:!0});if(!o)return O("createAccountShown"),(0,_.jsx)(Ot,{onUnload:q});let T=C&&!i&&Zt(E)&&!eo(E,s);if(T&&Ne()&&(T=!!a&&a.rate<=Ut()),T){let k=l("ext_post_checkout_fallback_deals");if(t&&l("ext_pcm_dismiss_throttle_same_day"))g("page","postCheckoutNotification",{view:"pcm_dismiss_throttle"});else{if(l("ext_pcm_new_offers"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:N,contentProps:{type:"newOffers"},isSingleOffer:!0});if(l("ext_post_checkout_multi_offer_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-multi-ad-offer",providedData:{throttleKey:"post-checkout-multi-ad-offer"},onUnload:N,contentProps:{type:"recommended"}});if(l("ext_pcm_thresh_test_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:N,contentProps:{type:"threshold"},isSingleOffer:!0});if(l("ext_pcm_retargeting_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-retargeting",providedData:{throttleKey:"post-checkout-retargeting"},onUnload:N,contentProps:{type:"deals",fillWithFallback:k}});if(l("ext_pcm_retargeting_product_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-retargeting-products",providedData:{throttleKey:"post-checkout-retargeting-products"},onUnload:N,contentProps:{type:"products",fillWithFallback:k}});if(l("ext_pcm_retargeting_multi_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-retargeting-multi",providedData:{throttleKey:"post-checkout-retargeting-multi"},onUnload:N,contentProps:{type:"multi",fillWithFallback:k}});if(l("ext_post_checkout_non_vm_feed_cta_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-retargeting-single_offer",providedData:{throttleKey:"post-checkout-retargeting-single_offer"},onUnload:N,contentProps:{type:"deals",fillWithFallback:k},isSingleOffer:!0});if(l("ext_post_checkout_recommended_offers_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-recommended-offers",providedData:{throttleKey:"post-checkout-recommended-offers"},onUnload:N,contentProps:{type:"recommended"}});if(l("ext_post_checkout_recommended_offers_single_cta_v_2"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:N,contentProps:{type:"recommended"},isSingleOffer:!0});if(l("ext_post_checkout_recommended_single_product_v_3"))return(0,_.jsx)(S,{startTime:e,blocksSlug:"post-checkout-single-recommended-product",providedData:{throttleKey:"post-checkout-single-recommended-product"},onUnload:N,contentProps:{type:"recommendedProducts"},isSingleOffer:!0})}}return!n&&jt()?(0,_.jsx)(_t,{contentSlug:"blocks-notification",blocksSlug:"blocks-notification",onUnload:q,providedData:Xt,includeTopDeals:!0}):l("desktopextension_postcheckout_referrals")&&Y("postcheckout_modal_desktop_ref_switch_")&&!r?(0,_.jsx)(Ce,{onUnload:q}):null}function Ne(){return l("ext_pcm_threshold_switch")}function Ut(){return te("ext_pcm_threshold_rate_",10)}function oo(){return te("postcheckout_modal_dtm_xd_06242025_",30*24*60)*6e4}function ro(){return te("desktop_ext_pcm_referrals_throttle_days_",7)*864e5}async function no(e,t){if(e==="midOrderPlacedBox"){let o="div.celwidget.thank-you-box-parent-a11y div.a-box-inner > div.a-box > div.a-box-inner > :first-child",r=document.querySelector(o);if(!r){O("amazonContainerNotFound",[`type:${e}`]),g("page","postCheckoutRetargeting",{view:"amazon_post_checkout_container_not_found",meta:JSON.stringify({query:o})});return}let n=Array.from(r.childNodes).filter(i=>i.nodeType===Node.ELEMENT_NODE);if(n.length===2&&r.clientWidth>900){let i=n[0],a=n[1];$=(await ae({appName:"postCheckoutAmazonEmbeddedNotification",app:(0,_.jsx)(be,{type:e,opBox:i,adBox:a,container:r,startTime:t}),mountPointStyle:"float: left;",mountClass:"w-[430px] float-left",insertAfterElement:i,positionOnTop:!1})).unloadApp}else{let i=r.clientWidth<=900,a=n.length!==2;O("amazonContainerUnknownFormat",[`widthMiss:${i}`,`nodeCountMiss:${a}`]),g("page","postCheckoutRetargeting",{view:"amazon_post_checkout_container_unknown_format",meta:JSON.stringify({query:o,nodeCount:n.length,width:r.clientWidth})})}$=refs.unloadApp}else{let o=e==="orderPlacedBox"?"div.celwidget.thank-you-box-parent-a11y div.a-box-inner > div.a-row":"div.celwidget.thank-you-box-parent-a11y",r=document.querySelector(o);if(!r){O("amazonContainerNotFound",[`type:${e}`]),g("page","postCheckoutRetargeting",{view:"amazon_post_checkout_container_not_found",meta:JSON.stringify({query:o})});return}$=(await ae({appName:"postCheckoutAmazonEmbeddedNotification",app:(0,_.jsx)(xe,{type:e,centered:e!=="orderPlacedBox",startTime:t}),mountClass:"max-w-96 mx-auto",insertAfterElement:r,positionOnTop:!1})).unloadApp}}function io(e,t,o){return e?"orderPlacedBox":t?"midOrderPlacedBox":o?"midScreen":"none"}async function ao(){q();let e=m.get(["siteAPIData","tld"])||"",t=Date.now(),[o]=await Promise.all([so(),wt()]);co(o),me("gotFeedTypes",t),O("confirmationPage",[`tld:${ct(e)}`]);let[r,n,i,a,s,C,x]=await Promise.all([Dt(),it(),se(ro(),"postcheckout_modal_referrals"),se(oo(),"blocks_cross_device_throttle"),se(2*864e5,Se),Ne()?St():void 0,xt()]);if(It(e)&&Ft(s,C)){let T=l("ext_pcm_amazon_opb_notif"),k=l("ext_pcm_amazon_mid_opb_notif"),F=l("ext_pcm_amazon_mid_screen_notif");if(T||F||k){let A=io(T,k,F);no(A,t);return}}$=(await ae({appName:"blocksNotification",blankSlate:!0,app:(0,_.jsx)(to,{startTime:t,dismissedNotifPastDay:n,createAccountThrottled:!r,referralsThrottled:i,xSellThrottled:a,retargetingThrottled:s,userElasticity:C,retargetingExclusions:x,canShowRetargetingOnDomain:o.canShowRetargeting})})).unloadApp}async function so(){let e=m.get("siteAPIData"),t=e?.tld,o=["products","deals","multi","recommended","threshold","recommendedProducts"];return l("ext_pcm_new_offers")&&o.push("newOffers"),await dt(o,t)}function co(e){let t=!1,o=Object.keys(e).reduce((i,a)=>{if(!ft(a,e[a]))return i;let s=e[a]?.length||0;return t=t||s>0,i[`${a}Retargeting`]=s,i},{}),r=t?"offers_available":"no_offers_available",n=JSON.stringify({offers:o,df:e.df??[],dnf:pt(e),canShowRetargeting:e.canShowRetargeting});g("page","postCheckoutNotification",{view:r,meta:n})}async function At(){try{let e=l("ext_debug_blocks_notifs"),t=await ze(),{pageType:o}=t||{},r=gt()?[Pe.BonusOfferType.desktopToMobileAppBonus,Pe.BonusOfferType.firstTimeEmailActivationBonus]:void 0,n=await Et(t,["productPage"],{allowOnly:r});if(n){q();let a=await Ct(n);a&&($=a.unloadApp);return}if(!(e||o==="confirmationPage"))return;await ao()}catch(e){console.error(e)}}document.readyState!=="loading"?At():document.addEventListener("DOMContentLoaded",At);export{ro as getPCMReferralsThrottleDuration};
