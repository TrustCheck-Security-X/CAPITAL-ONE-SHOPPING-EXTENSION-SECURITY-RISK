import{a as I}from"../chunks/chunk-YW2GBCD5.js";import{a as B,b as h}from"../chunks/chunk-77Z4FAWZ.js";import"../chunks/chunk-DWQLULSJ.js";import{a as z}from"../chunks/chunk-LTOPIHVT.js";import{a as K}from"../chunks/chunk-IUMQMMIE.js";import{a as L}from"../chunks/chunk-M25S27FE.js";import{a as O,b,d as V,u as F}from"../chunks/chunk-FC47YOH3.js";import{a as R}from"../chunks/chunk-AHBXB3LJ.js";import"../chunks/chunk-T3OFRK44.js";import"../chunks/chunk-2JQDE4PE.js";import"../chunks/chunk-FMNBUMJ5.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-CXSZXIOJ.js";import"../chunks/chunk-QLZPWOED.js";import"../chunks/chunk-OCTA2RVM.js";import"../chunks/chunk-YQ5KARKK.js";import"../chunks/chunk-DKGSS5NA.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-IJEQYNEP.js";import"../chunks/chunk-TFT336KV.js";import"../chunks/chunk-TYA5STFG.js";import{p as q}from"../chunks/chunk-4MWWZMVF.js";import{a as N,b as T,g as D,h as d,n as p,o as E,q as Q,v as M}from"../chunks/chunk-2WJMAHXV.js";import"../chunks/chunk-7H4H32QC.js";import"../chunks/chunk-54ERVKKM.js";import"../chunks/chunk-VM2OHO33.js";import"../chunks/chunk-6I5TZL5E.js";import"../chunks/chunk-W7K6NY26.js";import"../chunks/chunk-QWQLNDJC.js";import"../chunks/chunk-WRIUWJSJ.js";import"../chunks/chunk-4MSTBY6L.js";import"../chunks/chunk-ECXCPAF6.js";import{i as J}from"../chunks/chunk-CBPLEXH3.js";import{e as A}from"../chunks/chunk-C4QCPH6A.js";import{d as u,f as G}from"../chunks/chunk-ZRHTGYWI.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-J5H5CHL2.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as C}from"../chunks/chunk-3GYLW4KZ.js";var x=C(Q()),a=C(A());var m=C(A()),H=C(J());G();var $=(e,o,t)=>R("deweyPriceComparisonWithoutNotif",{priceComparisonKey:e,product:o,pageData:t});var w,k,X=250,Z=2500;function ee(e){return e.url}async function te(e){let o=e?.pageTypeBehaviors,c=(Array.isArray(o?.notifPlacementSelectors)?o.notifPlacementSelectors:[]).map(({value:i})=>i);return{runOptions:{input:{}},buttonShouldMountInline:!!c.length,findElementToInsertAfter:()=>{for(let i of c){let s=document.querySelector(i);if(s)return s}},showNotification:o?.showNotification,priceThresholdCents:o?.deweyPCThreshold||Z}}function oe(e,o){return e.price?O(e.price,o,"disable_universal_price_run")?!1:{priceComparisonKey:ee(e)}:(u("Dewey PC - unable to retrieve the origin product price."),!1)}function U(e){try{k||(k=m.default.debounce(ne,X)),k(e)}catch(o){u(o)}}async function ne(e){try{if(!(!I()&&p("dewey_price_comparison")&&m.default.get(e,"pageTypeBehaviors.deweyPC",!1))||m.default.get(e,"domain")==="amazon.com")return;let t=m.default.cloneDeep(m.default.get(e,"pageData.products[0]",{}));t.vendor=m.default.get(e,"domain"),t.price=t.list_price,t.mpn=t.manufacturer_number,delete t.list_price,delete t.manufacturer_number;let c=e.pageType,i=await te(e),s=oe(t,i?.priceThresholdCents);if(!i?.showNotification)return p("dewey_price_comparison_silent")&&s&&$(s.priceComparisonKey,t,{pageViewId:d.get("pageViewId"),pageType:c});if(!s){w="",q(b);return}let{priceComparisonKey:r}=s;if(r===w){u(`*** Skipping dewey price comparison already in progress for request - ${r} ***`);return}u(`*** Starting dewey price comparison. Request - ${r} ***`),w=r,i.runOptions.input.product=t,m.default.set(i.runOptions.input,"meta.conquestOrigin",!0),m.default.set(i.runOptions.input,"meta.simpleOriginPricing",!0),m.default.set(i.runOptions.input,"deweyPC",!0);let n=i.findElementToInsertAfter(),f=p("retail_pc_non_amazon_best_result"),y=f?"best-deal":"",g=p("price_comparison_floating_notif_non_amz")&&(p("retail_pc_floating_notif_sticky")||p("retail_pc_floating_notif_non_sticky")),S=p("retail_pc_floating_notif_non_sticky"),{mountPoint:P}=await F({insertAfterElement:n,removeExistingApp:!0,unmountExistingReactRoot:!0,additionalClass:y},{...i.runOptions,buttonNotMountedInline:i.buttonShouldMountInline&&!n,pageType:c,isFloatingNotif:g,isBestDealNotif:f,isFloatingNotifNonSticky:S,autoShowSavingsNotificationStatus:V(),runCompleteCb:()=>{w&&w===r&&(w="",u(`*** Request - ${r} - completed ***`,"*** Active Dewey price comparison was reset. ***"))}});if(P&&!(n&&document.documentElement.contains(n)&&n.parentElement===P.parentElement)){let Y=()=>{if(u("*** attempting to put annotation in position ***"),(!n||!document.documentElement.contains(n))&&(n=i.findElementToInsertAfter()),n&&(n.parentNode.insertBefore(P,n.nextSibling),n.parentElement===P.parentElement))return d.set(["productEstimateAnnotations"],{[b]:{hasSavingsButton:!0}}),!0};try{await(0,H.default)(Y,{maxRetries:5})}catch(j){u("*** attempts to verify annotation position likely expired *** ",j)}}}catch(o){u(o)}}var W=e=>(U(e),M("deweyResult",e));window.__wb_timing.deweyRequireAt=performance.now();async function ie(){await Promise.all([K(),L()]).then(([e,o])=>{z(e),d.merge({siteAPIData:o})}),p("ext_instant_init_notifs")||document.readyState!=="loading"?v():document.addEventListener("DOMContentLoaded",v)}async function v(){let e=d.get("siteAPIData"),o=a.default.get(e,"tld");T(o),e=await ae(e)||e;let t=a.default.cloneDeep(e);t.document=document,function(l){let r=l.fn.find;l.fn.find=function(n){return n===":self"?this:r.call(this,n)}}(x.default),t.document.deweyParser=x.default,t.document.html=document.documentElement.innerHTML,a.default.set(t,"siteData.tld",t.tld),h.setDefaultConfig(t);let c=p("log_all_dewey"),i=new Date,s=new Set(a.default.map(a.default.get(e,"siteData.tigger.coupons")||a.default.get(e,"siteData.roo.coupons")||[],"code"));h.emitter.on("result",async l=>{let r=l?.pageType,n=!1,f=await B(l);if(f.callSource==="internal"&&(d.set(["deweyResult"],f),W(f),r||c)){let y=new Date-i,g=a.default.cloneDeep(f);g&&g.pageData&&g.pageData.meta&&(g.pageData.meta=[g.pageData.meta]);let S=!n&&r!=="sponsoredProductsPage"?void 0:{anonymized:n,skipAllowlistCheck:r==="sponsoredProductsPage",skipSendingPageContextData:r==="sponsoredProductsPage"};E("track","deweyResult",a.default.assign({},g,{flags:a.default.get(e,"siteData.flags"),logAllDewey:c,totalTimeElapsed:y,deweyAttempt:h.startAttempt,emailId:d.get("emailId")}),S)}a.default.get(f,"pageData.coupons.length")&&a.default.forEach(f.pageData.coupons,y=>{s.has(y)||(E("track","codeApplied",{code:y,currentLocation:a.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),s.add(y))})}),h.start()}async function _(e,o){return await D({message:"getPlatformIdentifiers",platformForIdentifiers:e,platformPageTypeForIdentifiers:o})}async function ae(e){let o=a.default.get(e,"siteData.coupons.type"),[t,c=N()]=await Promise.all([D({message:"getPlatform"}),D({message:"getPlatformDomain"})]);if(t&&c){T(c),e=a.default.has(e,"siteData.tigger")?e:{...e,siteData:{...e.siteData,tigger:{}}},e.siteData.tigger[`${t.toLowerCase()}`]=!0,e.siteData.pageTypesV2=e.siteData.pageTypesV2||{};let{cartPage:i,checkoutPage:s,confirmationPage:l}=e.siteData.pageTypesV2;new Set(["Magento","WooCommerce","BigCommerce","Squarespace"]).has(t)?(t==="Magento"&&(e.siteData.pageTypesV2.cartPage=i||await _(t,"cartPage")),e.siteData.pageTypesV2.checkoutPage=s||await _(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=l||await _(t,"confirmationPage")):(e.siteData.pageTypesV2.checkoutPage=await _(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=await _(t,"confirmationPage"));let n=await _(t,"roo");return n&&o!=="roo"&&(e.siteData.roo=n),e}}ie();
