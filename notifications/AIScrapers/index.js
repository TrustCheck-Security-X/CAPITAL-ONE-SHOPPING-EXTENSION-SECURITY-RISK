import{a as he,b as Se}from"../../chunks/chunk-DU22QCKB.js";import{B as ge,Q as L,X as He,d as Oe,h as x,n as M,o as I}from"../../chunks/chunk-2UBRAF2E.js";import{a as be,b as Ae}from"../../chunks/chunk-KL54U6NQ.js";import{a as Ie}from"../../chunks/chunk-O2KE44VO.js";import{a as pe,b as ve,c as $,d as F,e as xe,f as z,g as q,h as Q,i as S,j as ie,k as fe,m as Me}from"../../chunks/chunk-GXARYUH5.js";import{a as s,b as se,h as Z}from"../../chunks/chunk-7VR4VJF6.js";import"../../chunks/chunk-DWQLULSJ.js";import{a as ke}from"../../chunks/chunk-LTOPIHVT.js";import{a as Le}from"../../chunks/chunk-IUMQMMIE.js";import"../../chunks/chunk-IYAFYZRF.js";import{a as Pe}from"../../chunks/chunk-CXSZXIOJ.js";import{b as Ee}from"../../chunks/chunk-OCTA2RVM.js";import"../../chunks/chunk-F2BE3OL5.js";import{a as Ke}from"../../chunks/chunk-IJEQYNEP.js";import{a as Ce}from"../../chunks/chunk-TFT336KV.js";import"../../chunks/chunk-TYA5STFG.js";import{q as X}from"../../chunks/chunk-4MWWZMVF.js";import{n as J,o as B}from"../../chunks/chunk-2WJMAHXV.js";import{c as ue,s as Be}from"../../chunks/chunk-QWQLNDJC.js";import{F as U,G as oe,H as V,I as we,z as de}from"../../chunks/chunk-4MSTBY6L.js";import"../../chunks/chunk-ECXCPAF6.js";import"../../chunks/chunk-CBPLEXH3.js";import{e as _e,f as ze}from"../../chunks/chunk-C4QCPH6A.js";import"../../chunks/chunk-ZRHTGYWI.js";import"../../chunks/chunk-53OM6ECF.js";import"../../chunks/chunk-J5H5CHL2.js";import"../../chunks/chunk-PDIOZR2P.js";import"../../chunks/chunk-WO6N5TBT.js";import"../../chunks/chunk-BTBTC4NL.js";import{e as b}from"../../chunks/chunk-3GYLW4KZ.js";var je=b(de());we();var $e=b(_e());var w=b(de()),ee=b(Ke());Be();var De=b(_e()),Ne=b(ze());we();var O=b(de());function ye({query:e,prop:u,startValue:i}){let r=(0,O.useRef)(null),[n,m]=(0,O.useState)(i),h=(0,O.useRef)(i),o=(0,O.useRef)(0),g=(d,p,l)=>d*(1-l)+p*l,t=(0,O.useCallback)(()=>{if(!r.current&&(r.current=document.querySelector(e),!r.current)){console.warn(`Element not found for animation query: ${e}`);return}let d=g(h.current,n,.03),p=Math.abs(d-n)<.1;if(h.current=p?n:d,r.current.style[u]=`${h.current}px`,p){cancelAnimationFrame(o.current);return}o.current=requestAnimationFrame(t)},[n]);return(0,O.useEffect)(()=>(o.current=requestAnimationFrame(t),()=>cancelAnimationFrame(o.current)),[t]),{setTargetValue:m}}var c=b(oe()),Ge=2,ae=15,K=315,Ye=40;function Je(e,u){let i=[];return Object.keys(e).forEach(r=>{let n=e[r],m=u[r];n&&typeof n=="object"&&(n.relevant??[]).forEach(o=>{let g=m&&m.hasParseDomain==="true"&&m.parseDomainProp&&o[m.parseDomainProp]&&o[m.parseDomainProp].length>0;o.link?i.push({title:o.title||o.description||"",url:o.link.replace("&utm_source=chatgpt.com","").replace("?utm_source=chatgpt.com&","?").replace("?utm_source=chatgpt.com",""),key:o[pe]}):g&&i.push({title:o.title||o.description||"",parseDomain:o[m.parseDomainProp]||"",key:o[pe]})})}),i}function Xe({startTime:e,offers:u}){let[i]=(0,w.useState)(u),{getValue:r,getRichText:n}=U(ge.AI_SEARCH_CGPT),m=u.map(t=>t.tld),[h]=(0,w.useState)(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches);(0,w.useEffect)(()=>{L({name:"cgpt_impression",type:x,subType:h?I:M}),se("offersInjected",e,["mode:chatGPT","type:bottom"]),s("offerNotifShown",["mode:chatGPT","type:bottom"]),u.forEach(t=>{s("offerShown",["mode:chatGPT",`tld:${Z(t.tld)}`])}),setTimeout(()=>{let t=document.querySelector(r("scrollContainer"));t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})},500)},[]);let o=(t,d)=>{L({name:"cgpt_click",type:x,subType:h?I:M,redirect:!0,label:t.displayName,carouselPosition:d,rewardAmount:t.rewardsRate,meta:t}),s("offerClicked",["mode:chatGPT","type:bottom",`tld:${Z(t.tld)}`]),window.open(t.href,"_blank","noopener,noreferrer")},g=()=>{let t=ue(new Date,{minutes:60}).getTime();he({componentName:"cgpt",throttleValue:t}),s("offersDismissed",["mode:chatGPT","type:bottom"]),L({name:"cgpt_dismiss",type:x,subType:h?I:M,redirect:!1,label:"x"})};return i.length<Ge?null:(0,c.jsx)("div",{className:"flex flex-col w-full",children:(0,c.jsx)(be,{getValue:r,onHideNotif:g,wrapperClass:"w-full",domains:m,children:(0,c.jsx)("div",{className:"w-full overflow-hidden overflow-x-scroll",children:(0,c.jsx)("div",{className:"flex flex-row align-start space-x-4 p-2",children:i.map((t,d)=>(0,c.jsxs)("div",{className:"flex flex-col justify-start items-center border-solid border border-border min-w-[192px] bg-white cursor-pointer hover:outline hover:outline-[3px] hover:outline-blue-500 dark:bg-gray-950",onClick:()=>o(t,d),children:[(0,c.jsx)("div",{className:"flex items-center justify-center w-full bg-white",children:(0,c.jsx)("div",{className:"flex items-center justify-center w-[180px] h-[142px]",children:(0,c.jsx)("img",{className:"max-w-full max-h-full object-contain",src:fe(t.tld)})})}),(0,c.jsxs)("div",{className:"w-full text-base self-start space-y border-solid border-t border-gray-150 pt-2 px-2",children:[(0,c.jsx)("div",{children:(0,c.jsx)(V,{items:n({itemName:t.rewardHasPrefix?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:t.displayReward}})})}),(0,c.jsx)("div",{className:"max-w-[142px] line-clamp-2 h-12",children:(0,c.jsx)(V,{items:n({itemName:"description",parseValues:{merchant:t.displayName}})})})]})]},t.key))})})})})}function Ze({startTime:e,offers:u,chatEl:i}){let r=J("ext_prcs_ais_shifting_chat"),n=J("ext_prcs_ais_animating_offers"),[m]=(0,w.useState)(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),h=i.clientWidth,{getValue:o,getRichText:g}=U(ge.AI_SEARCH_CGPT_UR_EMBEDDED),{getSequence:t}=U("llm_scraper_cpt"),d=ie(t,"sidePanel"),[p,l]=(0,w.useState)(!1),[H,A]=(0,w.useState)(0),[C,E]=(0,w.useState)(0),y=Ae(),T=(0,w.useRef)(document.querySelector(o("headerQuery"))),v=(0,w.useRef)(!1),{setTargetValue:P}=ye({query:o("fullChatContainerQuery"),prop:"margin-right",startValue:0}),[k,W]=(0,w.useState)(n),te=(0,w.useRef)(!1);(0,w.useEffect)(()=>{!te.current&&n&&re()&&C>0&&(te.current=!0,setTimeout(()=>{W(!1)},300))},[C]),(0,w.useEffect)(()=>{se("offersInjected",e,["mode:chatGPT","type:upper_right"]),s("offerNotifShown",["mode:chatGPT","type:upper_right"]),u.forEach(f=>{s("offerShown",["mode:chatGPT",`tld:${Z(f.tld)}`])}),L({name:"cgpt_ur_impression",type:x,subType:m?I:M})},[]);function Y(){let f=T.current?.clientHeight||0;A(f);let N=((T.current?.clientWidth||0)-h)/2-ae;E(N)}(0,w.useEffect)(()=>{p||Y()},[y,p]);function j(){n?W(!0):l(!0)}function ne(){return(K+ae-C)*2}function re(f=ne()){return f+h+Ye<T.current?.clientWidth}function le(){if(C<K+ae){let f=ne();if(!re(f)){j(),P(0);return}P(f),v.current=!0}else v.current&&(P(0),v.current=!1)}function me(){C<K&&(s("widthDismiss",["mode:chatGPT","type:upper_right",`hasBumpingChat:${r}`]),L({name:"cgpt_ur_width_holdout",type:x,subType:M,redirect:!1}),j())}(0,w.useEffect)(()=>{p||!C||k||(r?le():me())},[C,p,k]),(0,w.useEffect)(()=>{if(!p){let f=setInterval(()=>{let D=window.document.querySelector(d.query);Y(),D&&(s("autoDismiss",["mode:chatGPT","type:upper_right","reason:sidePanelShown"]),L({name:"cgpt_ur_auto_dismiss",type:x,subType:m?I:M,redirect:!1,label:"sidePanelShown"}),j())},300);return()=>{clearInterval(f)}}},[p]);let a=()=>{r&&P(0),s("offersDismissed",["mode:chatGPT","type:upper_right"]),j();let f=ue(new Date,{minutes:60}).getTime();he({componentName:"cgpt",throttleValue:f}),L({name:"cgpt_ur_dismiss",type:x,subType:m?I:M,redirect:!1,label:"x"})},_=(f,D)=>{L({name:"cgpt_ur_click",type:x,subType:m?I:M,redirect:!0,label:f.displayName,carouselPosition:D,rewardAmount:f.rewardsRate,meta:f}),s("offerClicked",["mode:chatGPT","type:upper_right",`tld:${Z(f.tld)}`]),window.open(f.href,"_blank","noopener,noreferrer")};function R(){let f=u.map(D=>D.tld);Me(f)}let G=f=>{f==="view_terms"&&R()};return p&&!n?null:(0,c.jsx)(ee.Motion,{style:{opacity:(0,ee.spring)(k?0:1,{stiffness:180,damping:20}),x:(0,ee.spring)(k?110:0,{stiffness:180,damping:20})},children:({opacity:f,x:D})=>(0,c.jsx)("div",{className:"fixed",style:{zIndex:2147483647,top:H+15,width:K,right:15,transform:`translate3d(${D}%,0,0)`,opacity:`${f}`},children:(0,c.jsxs)("div",{className:"flex flex-col w-full p-2",children:[(0,c.jsxs)("div",{className:"flex flex-row w-full",children:[(0,c.jsx)(Ce,{showFullLogo:!0,dark:m}),(0,c.jsx)("span",{className:"my-auto ml-auto dark:text-gray-50",children:(0,c.jsx)(Pe,{width:25,height:25,small:!0,onClick:a})})]}),(0,c.jsx)("span",{className:"text-lg font-semibold my-2 dark:text-gray-50",children:o("header")}),(0,c.jsx)("div",{className:"w-full",children:u.map((N,Ve)=>(0,c.jsxs)("div",{className:"flex flex-row w-full h-[80px] justify-start items-center cursor-pointer border border-solid border-gray-150 hover:outline hover:outline-[3px] hover:outline-blue-500 my-2 px-2",onClick:()=>_(N,Ve),children:[(0,c.jsx)("div",{className:"flex items-center justify-center w-[60px] h-[48px] bg-white border border-white border-solid",children:(0,c.jsx)("img",{className:"max-w-full max-h-full object-contain",src:fe(N.tld)})}),(0,c.jsxs)("div",{className:"flex flex-col flex-1 text-base ml-4 my-auto",children:[(0,c.jsx)(V,{items:g({itemName:"description",parseValues:{merchant:N.displayName}})}),(0,c.jsx)(V,{items:g({itemName:N.rewardHasPrefix?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:N.displayReward}})})]}),(0,c.jsx)(Ee,{className:"text-blue-500 h-8 w-8 mr-2"})]},N.key))}),(0,c.jsx)(V,{onClick:G,items:g({itemName:"exclusions"})})]})})})}async function Te(e,u,i,r){if(await He("cgpt"))return;let m=Date.now();s("injectOffers",["mode:chatGPT"]);let h=Je(e,r);if(h.length>0){s("hasLinks",["mode:chatGPT"]);let o={experience:"extension",subexperience:"ai_search"},{offers:g}=await Se(h,o);se("gotOffers",m);let t=De.default.chain(g).uniqBy("tld").orderBy("rewardsRate","desc").take(4).value();if(t.forEach(d=>{d.href=d.href.replace(Oe,(0,Ne.v4)())}),t.length>=Ge){L({name:"cgpt_available_products",type:x,subType:M,meta:t});let d=window.matchMedia("(prefers-color-scheme: dark)").matches,p=window.document.querySelector(i),H=window.document.querySelector("header#page-header")?.clientWidth||0,A=(H-(u?.clientWidth||0))/2-ae,C=!p&&A>=K;L({name:C?"cgpt_offers_ur_width_met":"cgpt_offers_ur_width_not_met",type:x,subType:d?I:M,meta:{showingSidePanel:!!p,headerWidth:H,offerWidth:A,hasEnoughWidth:A>=K}}),J("ext_prcs_ais")?await X({appName:"ai_search_cgpt",app:(0,c.jsx)(Xe,{startTime:m,offers:t}),mountClass:"max-w-96 mx-auto",removeExistingApp:!0,insertAfterElement:u.parentNode,positionOnTop:!1}):J("ext_prcs_ais_ern")?await X({appName:"ai_search_cgpt_ern",removeExistingApp:!0,app:(0,c.jsx)(Ze,{startTime:m,offers:t,chatEl:u})}):L({name:"cgpt_holdout",type:x,subType:d?I:M})}else L({name:"cgpt_dm_min_offer_miss",type:x,subType:M,meta:{offerCount:t.length}})}}function Fe(e,u){let i="chatGPT",r={},n="",m=0,h=!1,o=S(u,"containerElements"),g=S(u,"sidePanelElements"),t=S(u,"popoverElements"),d=!1,p={query:e("popoverQuery"),propScrape:{}},l=ie(u,"sidePanel"),H={containerQuery:e("containerQuery"),responseQuery:e("responseQuery")},A=function(){p._el_.isConnected&&k()},C=$e.default.debounce(A,500,{maxWait:1e3}),E=new MutationObserver(C),y={attributes:!0,childList:!0,subtree:!0,characterData:!0};function T(a,_){_.disconnect(),_.observe(a,y)}function v(){let a={};for(let _ in t)a[_]=ve(p._el_,t[_].propScrape);return a}function P(a){B("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify({chatGPTMode:!0,inShoppingResearchMode:d,hasTermCheck:z(),...a})},{anonymized:!0,skipAllowlistCheck:!0})}function k(){let a=v();s("popoverCycled",[`mode:${i}`]),P({eventType:"popoverCycled",result:a})}function W(){let a=v();s("popoverOpened",[`mode:${i}`]),P({eventType:"popoverOpened",result:a})}async function te(a){if(!l._el_)return;s("sidePanelQuery",[`mode:${i}`]),F([g]);let _=await $(l._el_,g);await q(g);let R=Q(g);_?(s("sidePanelHasResults",[`mode:${i}`]),P({eventType:"sidePanel",buttonInfo:a,result:R})):s("sidePanelNoResults",[`mode:${i}`])}function Y(a){clearInterval(a.interval),a.interval=0,a.runTime=0}let j=a=>{l.interval&&Y(l),l._el_=window.document.querySelector(l.query),l.interval=setInterval(()=>{let _=l._el_?.querySelector(l.loadingIndicator);l.runTime+=l.runInterval,(!_||l.runTime>=l.runLimit)&&(Y(l),setTimeout(()=>{te(a)},l.runInterval))},l.runInterval)};async function ne(a,_){a==="nonLinkButton"&&setTimeout(()=>{j(_)},1e3)}async function re(a,_){F([o]);let R=await $(a,o,ne);await q(o);let G=Q(o);R?(P({eventType:"newResponse",...G}),s("containerHasResults",[`mode:${i}`]),Te(G,_,l.query,o)):s("containerNoResults",[`mode:${i}`])}async function le(){let a=window.document.querySelectorAll(H.containerQuery),_=window.location.href;if(n===""&&(n=_),n!==_&&(s("chatChange",[`mode:${i}`]),n=_,r[n]||(r[n]=0),m=r[n]),a.length>m){s("newChatContainer",[`mode:${i}`]);let R=window.document.querySelector(e("shoppingModeQuery"));d=!!R&&R.innerText?.indexOf(e("shoppingResearchButtonText"))>-1,m=a.length,r[n]=a.length;let G=window.document.querySelectorAll(H.responseQuery);await re(G[G.length-1],a[m-1])}}async function me(){if(h)return;let a=window.document.querySelectorAll(p.query);a.length>0&&p._el_!==a[0]&&(p._el_=a[0],T(a[0],E),W())}return l._el_=window.document.querySelector(l.query),setInterval(()=>{le(),me()},500)}function qe(e,u){let i="gemini",r={},n="",m=0,h=e("containerQuery"),o=S(u,"containerElements");async function g(d){F([o]);let p=await $(d,o);await q(o);let l=Q(o);p?(s("containerHasResults",[`mode:${i}`]),B("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify({geminiMode:!0,hasTermCheck:z(),result:l})},{anonymized:!0,skipAllowlistCheck:!0})):s("containerNoResults",[`mode:${i}`])}async function t(){let d=window.document.querySelectorAll(h),p=window.location.href;n===""&&(n=p),n!==p&&(s("chatChange",[`mode:${i}`]),n=p,r[n]||(r[n]=0),m=r[n]),d.length>m&&(s("newChatContainer",[`mode:${i}`]),m=d.length,r[n]=d.length,setTimeout(async()=>{await g(d[d.length-1])},2e3))}return setInterval(()=>{t()},1e3)}function Qe(e,u){let i=!1,r="googleAI",n=0,m=new Set([""]),h=S(u,"containerElements"),o=S(u,"searchPaneElements"),g=e("containerQuery"),t=e("searchPaneQuery"),d=e("googleHeaderQuery"),p=e("AIModeText"),l={searchLink:{prefix:"/search?",count:0},viewerLink:{prefix:"/viewer/",count:0}};function H(E){Object.keys(E).forEach(y=>{Object.keys(l).forEach(T=>{E[y].foundLinks&&E[y].foundLinks.length>0&&(l[T].count+=E[y].foundLinks.filter(v=>v.startsWith(l[T].prefix)).length)})})}async function A(E,y,T){F([y]);let v=await $(E,y);H(y),await q(y);let P={googleAIMode:!0,newSearchContainer:T,newSearchPaneOpen:!T,hasTermCheck:z(),result:Q(y)};Object.keys(l).forEach(k=>{let W=l[k];P[k]=W.count}),v?(s(T?"containerHasResults":"sidePanelHasResults",[`mode:${r}`]),B("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify(P)},{anonymized:!0,skipAllowlistCheck:!0})):s(T?"containerNoResults":"sidePanelNoResults",[`mode:${r}`])}async function C(){let E=Array.from(window.document.querySelectorAll(d));if(E.length>0&&E.find(y=>y.innerText===p)){i||(i=!0,s("addingScraper",["mode:googleAI"]));let y=window.document.querySelectorAll(g),T=window.document.querySelectorAll(t),v=T.length>0?T[T.length-1].getAttribute("id")??"":"",P=y.length>n,k=!m.has(v);P?(n=y.length,s("newChatContainer",[`mode:${r}`]),setTimeout(async()=>{A(y[y.length-1],h,!0)},2e3)):k&&(s("sidePanelQuery",[`mode:${r}`]),m.add(v),setTimeout(async()=>{A(T[T.length-1],o,!1)},2e3))}}return setInterval(()=>{C()},1e3)}var Ue=b(oe());async function et(){let[e]=await Promise.all([Le(),Ie()]);ke(e)}function tt({type:e}){let{getValue:u,getSequence:i}=U(nt(e));return(0,je.useEffect)(()=>{let r;return e==="gemini"?r=qe(u,i):e==="chatGPT"?r=Fe(u,i):e==="googleAI"&&(r=Qe(u,i)),()=>{r&&clearInterval(r)}},[u,i]),null}function nt(e){return e==="gemini"?"llm_scraper_gemini":e==="chatGPT"?"llm_scraper_cpt":e==="googleAI"?"llm_scraper_gaim":""}async function rt(e){await X({appName:"AIScraper",blankSlate:!0,app:(0,Ue.jsx)(tt,{type:e})})}async function We(){try{let e=xe();e!=="none"&&(e!=="googleAI"&&s("addingScraper",[`mode:${e}`]),await et(),await rt(e))}catch(e){console.error(e)}}document.readyState!=="loading"?We():document.addEventListener("DOMContentLoaded",We);
