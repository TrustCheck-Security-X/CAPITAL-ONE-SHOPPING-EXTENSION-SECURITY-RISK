import{a as mt}from"../chunks/chunk-5R4XKUTC.js";import{a as be,b as pt}from"../chunks/chunk-DU22QCKB.js";import{A as qe,B as q,C as Ge,D as ze,E as Qe,F as Je,G as We,H as G,I as te,J as Xe,K as Ze,L as et,M as tt,N as rt,O as ot,Q as h,R as z,S as it,T as nt,U as st,V as at,W as lt,X as ct,Y as dt,Z as Q,_ as ut,a as Se,b as Oe,c as ve,d as xe,e as ke,f as we,g as Ie,i as Re,j as Le,k as Ne,l as De,m as Me,p as $,q as Ue,r as Fe,s as He,t as Ae,u as Be,v as Ke,w as Ve,x as je,y as Ye,z as $e}from"../chunks/chunk-2UBRAF2E.js";import{a as ye}from"../chunks/chunk-O2KE44VO.js";import{a as I}from"../chunks/chunk-JMBQBF3T.js";import{m as Y}from"../chunks/chunk-GXARYUH5.js";import{e as b,f as L,h as w}from"../chunks/chunk-7VR4VJF6.js";import{a as Te}from"../chunks/chunk-TAISRZC3.js";import{b as Ce}from"../chunks/chunk-AHW6BBB4.js";import{a as R}from"../chunks/chunk-QCPV2SDO.js";import"../chunks/chunk-MYY6QNB4.js";import"../chunks/chunk-DWQLULSJ.js";import{c as Pe,d as ge,f as he,t as B,u as K,v as V,w as j}from"../chunks/chunk-OCTA2RVM.js";import"../chunks/chunk-F2BE3OL5.js";import{a as _e}from"../chunks/chunk-TFT336KV.js";import{n as Ee,q as ee}from"../chunks/chunk-4MWWZMVF.js";import{h as pe,o as A,t as me,v as fe}from"../chunks/chunk-2WJMAHXV.js";import{d as de,e as It}from"../chunks/chunk-QWQLNDJC.js";import{F as H,G as O,I as ue,z as F}from"../chunks/chunk-4MSTBY6L.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{f as Rt}from"../chunks/chunk-C4QCPH6A.js";import{d as k,f as ce}from"../chunks/chunk-ZRHTGYWI.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-J5H5CHL2.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import{d as Lt,e as Nt}from"../chunks/chunk-BTBTC4NL.js";import{c as kt,e as y,f as wt}from"../chunks/chunk-3GYLW4KZ.js";var _t=kt(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});var ft=(Nt(),wt(Lt)),J=ft.__importStar(F()),Dt=function(e){return J.createElement("svg",ft.__assign({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24"},e),J.createElement("path",{d:"M13.25 8.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0"}),J.createElement("path",{fillRule:"evenodd",d:"M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12m2 0c0 4.41 3.59 8 8 8s8-3.59 8-8-3.59-8-8-8-8 3.59-8 8",clipRule:"evenodd"}),J.createElement("path",{d:"M11 12a1 1 0 1 1 2 0v4a1 1 0 1 1-2 0z"}))};re.default=Dt});var bt=y(Rt());var Z=y(F());It();ue();var X=y(F()),Et=y(_t());ue();ce();var Mt="s_result",Ut="s_impression",Ft="sn_impression",Ht="sn_click",At=["ext_prcs_prompt_control","ext_prcs_su_modal_v2","ext_prcs_su_modal_sp","ext_prcs_su_modal_mp","ext_prcs_su_modal_cp","ext_prcs_use_service_for_image_url","ext_prcs_redirect_v3","ext_prcs_multi_prompt_pd","ext_prcs_multi_prompt_pd_button","ext_prcs_service_send_results"],W=(e,t)=>{let r={...t},i={anonymized:!1,features:pe.get(["session","features"]).filter(o=>At.includes(o)),skipAllowlistCheck:!0,skipSendingPageContextData:!0};A("track",e,r,i)},Pt=e=>{W(Mt,e)},gt=e=>{W(Ut,e)},ht=e=>{W(Ft,e)},N=e=>{W(Ht,e)};var M=y(F());var D=y(O());function oe({url:e,forceBgColor:t}){let r=(0,M.useCallback)((l,d)=>{if(!(!l||!d))try{let u=dt(l);if(u){let{color:p,alpha:g,useTrueColor:f}=u;if(f){let m=t?"rgba(250, 250, 250, 1)":`rgba(${p}, ${p}, ${p}, ${g})`;d.style.backgroundColor=m}}}catch{}},[]),i=(0,M.useRef)(null),o=(0,M.useRef)(null);return G()?(0,D.jsx)("div",{className:"flex items-center justify-center w-full h-[135px] bg-[#F0F0F0] border-solid border-b border-border",ref:o,children:(0,D.jsx)("img",{className:"max-w-full max-h-full object-contain",crossOrigin:"anonymous",ref:i,src:e,onLoad:()=>{r(i.current,o.current)}})}):(0,D.jsx)("div",{className:"flex items-center justify-center w-full h-[135px] bg-[#F0F0F0] border-solid border-b border-border",ref:o,children:(0,D.jsx)("img",{className:"max-w-full max-h-full object-contain",ref:i,src:e})})}var c=y(O()),Bt=(e,t)=>e==="EMBEDDED_MULTI_OFFER_PD"?t?je:Ve:e==="EMBEDDED_MULTI_OFFER_PD_BUTTON"?t?$e:Ye:"";function ie(e,t){let r=t.list_price??t.price_after_discount,i=e.rewardsType==="percentage"?r*(e.rewardsRate/1e4):e.rewardsRate,o=r-i,l=r<0||i<0||o<0||o>r||i>r||o===0;return{listPrice:r,rewards:i,priceAfterRewards:o,invalidPricing:l}}function ne({offer:e,product:t,variant:r,dark:i=!1,headerText:o,isSponsored:l=!0,onOfferClick:d,verticalLocation:u}){let p=I(),{formatCurrency:g}=(0,X.useContext)(Ee),{getValue:f}=H(q.MULTI_OFFER_PRICE_DISPLAY,{defaultValues:{displayReward:e.displayReward}}),m=e.hasCutRate?f("prefixed_rewards_text"):f("offer_reward");if(z(t.image))return k(`Image not found for product: ${t.title}`),null;let{listPrice:n,rewards:E,priceAfterRewards:T,invalidPricing:v}=ie(e,t);if(v)return k(`Invalid pricing for product: ${t.title}`),null;let x=e.imageUrl||t.image,s=()=>{d&&d({contentId:t.content_id,subcontentId:t.subcontent_id,headerText:o,subheaderText:m,ctaText:r==="EMBEDDED_MULTI_OFFER_PD_BUTTON"?f("cta_button_text"):void 0,redirectUrl:e.href,type:Ue,subType:Bt(r,i),redirect:!0,label:e?.tld??t?.seller,clickId:p,itemName:t?.title||"",hasOffer:!0,offer:e})},C=()=>{Y([e.tld])};(0,X.useEffect)(()=>{ht({notifType:"multi_offer",notifSubtype:"grey_box",sellerUrl:t.url,productImageUrl:x,productTitle:t.title,productListPrice:n,sectionPosition:e.position?.toString(),aboveFold:u,pageType:"sponsoredProductsPage",isSponsored:l,contentId:t.content_id,sellerDomain:e.tld,subcontentId:t.subcontent_id,rewardType:e.rewardsType,rewardAmount:e.rewardsRate,rewardSubtype:"elevated_rewards",notificationHeader:o,notificationSubheader:m,ctaText:r==="EMBEDDED_MULTI_OFFER_PD_BUTTON"?f("cta_button_text"):void 0})},[]);let U=ot()?f("card_dm_bg_color"):"#212121";return(0,c.jsxs)("div",{onClick:s,className:"flex flex-col justify-start items-center border-solid border border-border w-[195px] hover:outline hover:outline-[3px] hover:outline-blue-500 hover:shadow-md cursor-pointer",style:{minHeight:"250px",backgroundColor:i?U:"#FFFFFF"},children:[(0,c.jsx)(oe,{url:x,forceBgColor:Q(e.key)}),(0,c.jsxs)("div",{className:"pt-1 pb-2 pr-2 pl-2",children:[(0,c.jsxs)("div",{className:"text-base self-start mb-4",children:[(0,c.jsx)("div",{className:"text-green-550 font-bold text-lg dark:text-green-350",children:m}),(0,c.jsx)("div",{className:"text-sm text-gray-400 line-clamp-1 dark:text-gray-50",children:t.brand}),(0,c.jsx)("div",{className:"text-base text-blue-700 max-w-[195px] line-clamp-2 h-12 dark:text-blue-300",children:t.title})]}),(0,c.jsxs)("div",{className:"text-base self-start space-y-2",children:[(0,c.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,c.jsx)("div",{className:"text-gray-600 text-xs dark:text-gray-50",children:f("list_price")}),(0,c.jsx)("div",{className:"text-gray-600 text-xs dark:text-gray-50",children:g(n)})]}),(0,c.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,c.jsx)("div",{className:"text-green-550 text-xs dark:text-green-350",children:e.hasCutRate?f("rewards"):f("mid_offer_reward")}),(0,c.jsx)("div",{className:"text-green-550 text-xs dark:text-green-350",children:g(E)})]}),(0,c.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,c.jsxs)("div",{className:"flex items-center text-gray-600 text-xs gap-1 dark:text-gray-50",children:[f("price_after_rewards"),(0,c.jsx)(B,{children:(0,c.jsxs)(K,{delayDuration:150,children:[(0,c.jsx)(V,{className:"border-none outline-none shadow-none m-0 font-light min-w-0",children:(0,c.jsx)(Et.default,{className:"info-icon h-3 w-3"})}),(0,c.jsxs)(j,{side:"right",sideOffset:20,className:"font-light italic text-neutralsecondary",children:[f("rewards_tooltip_content")," ",(0,c.jsx)("span",{className:"italic underline cursor-pointer",onClick:a=>{a.stopPropagation(),C()},children:f("rewards_tooltip_content_link_text")})]})]})})]}),(0,c.jsx)("div",{className:"text-gray-600 text-xs dark:text-gray-50",children:g(T)})]})]}),r==="EMBEDDED_MULTI_OFFER_PD_BUTTON"&&(0,c.jsx)("div",{className:"flex flex-col",children:(0,c.jsx)(he,{size:"sm",className:"w-full border-none my-1 mr-0 p-0 dark:shadow-none",children:f("cta_button_text")})})]})]})}var _=y(O());function se({offers:e,products:t,variant:r,dark:i=!1,startTime:o,onDismiss:l,onOfferClick:d,verticalLocation:u,maxOffers:p=5}){let[g,f]=(0,Z.useState)(!0),m=Array.from(e).sort((s,C)=>C.rewardsRate-s.rewardsRate).map((s,C)=>(s.position=C+1,s.productSource=ut(s.key),s)).slice(0,p),{getValue:n}=H(q.MULTI_OFFER_PRICE_DISPLAY),E=R()?n("title"):n("not_logged_in_title"),T=t.reduce((s,C)=>(s[C.key]=C,s),{});e.forEach(s=>{Q(s.key)&&(T[s.key]={brand:s.displayName,image:s.imageUrl,key:s.key,list_price:s.listPrice,price_after_discount:s.listPrice,title:s.title,url:s.href})}),(0,Z.useEffect)(()=>{h({type:qe,subtype:"mo",notification_offer_details:JSON.stringify({offers:m.map(a=>({displayName:a.displayName,displayReward:a.displayReward,hasCutRate:a.hasCutRate,key:a.key,rewardHasPrefix:a.rewardHasPrefix,rewardsRate:a.rewardsRate,rewardsType:a.rewardsType,title:a.title,tld:a.tld}))})}),b("multiOfferPdShown",[`dark:${i}`]);let s=m.reduce((a,P)=>(a[P.tld]=(a[P.tld]||0)+1,a),{});Object.entries(s).forEach(([a,P])=>{b("multiOfferPdTldCount",[`tld:${w(a)}`],P)});let C=m.reduce((a,P)=>(z(T[P.key].image)&&(a[P.tld]=(a[P.tld]||0)+1),a),{});Object.keys(C).length>0&&(Object.entries(C).forEach(([a,P])=>{b("missingImages",[`tld:${w(a)}`],P)}),h({type:Ie,subtype:"mo"}));let U=m.reduce((a,P)=>{let vt=T[P.key],{invalidPricing:xt}=ie(P,vt);return xt&&(a[P.tld]=(a[P.tld]||0)+1),a},{});Object.keys(U).length>0&&Object.entries(U).forEach(([a,P])=>{b("missingPricing",[`tld:${w(a)}`],P)}),L("finished",o)},[]);let v=()=>{f(!1),b("multiOfferPdDismissed",[`dark:${i}`]),L("dismissed",o,[`dark:${i}`]);let s=de(new Date,{minutes:lt()}).getTime();be({componentName:"mo",throttleValue:s}),l?.()},x=()=>{let s=m.map(C=>C.tld);Y(s)};return g?(0,_.jsxs)("div",{className:"flex flex-col w-fit justify-center items-start px-4 pt-2 pb-4 border-solid border border-border bg-blue-50 dark:bg-gray-700",children:[(0,_.jsxs)("div",{className:"flex flex-row h-[50px] items-center justify-start w-full",children:[(0,_.jsx)("div",{className:"flex w-[174px]",children:(0,_.jsx)(_e,{showFullLogo:!0,className:"m-0",dark:i})}),(0,_.jsxs)("div",{className:"flex flex-row justify-between grow pl-6 pt-2",children:[(0,_.jsxs)("div",{className:"font-semibold text-base dark:text-gray-50",children:[E,(0,_.jsx)(B,{children:(0,_.jsxs)(K,{delayDuration:150,children:[(0,_.jsx)(V,{className:"border-none outline-none shadow-none m-0 pt-1 pr-3 pb-1 pl-2 font-light italic min-w-0",children:(0,_.jsx)(ge,{className:"info-icon h-4 w-4 dark:text-gray-50"})}),(0,_.jsxs)(j,{side:"right",sideOffset:20,className:"font-light italic text-neutralsecondary",children:[n("info_tooltip_content")," ",(0,_.jsx)("span",{className:"italic underline cursor-pointer",onClick:x,children:n("info_tooltip_content_link_text")})]})]})})]}),(0,_.jsx)(Pe,{className:"close-icon w-4 h-4 pl-[4px] mr-[7px] cursor-pointer text-neutralsecondary dark:text-gray-50",onClick:v})]})]}),(0,_.jsx)("div",{className:"flex flex-row justify-between align-start space-x-4",children:m.map(s=>(0,_.jsx)(ne,{offer:s,product:T[s.key],variant:r,dark:i,headerText:E,onOfferClick:d,verticalLocation:u},s.key))}),(0,_.jsx)("link",{rel:"prefetch",href:Ce("/lp/signup/embed/search-alerts"),as:"document"})]}):null}ce();var Tt=e=>fe("openSearchAlertsMerchantTab",e);var le=y(O()),S=[];async function Vt(){let e=await me(),{pageType:t}=e,r=Date.now();if(t==="sponsoredProductsPage"){if(await ye(),b("sponsoredProductsPage"),S=e.pageData.products??[],!S||S.length===0)return!1;let i="unknown",o=await St();o&&(i=await qt(o));let l=S.slice(0,20).map((n,E)=>{let T={key:n.key,url:n.url,domain:n.seller,title:n.title};return G()&&(T.imageUrl=n.image),T});S.forEach((n,E)=>{Pt({sectionType:"sponsored_pla",sellerUrl:n.url,productTitle:n.title,productListPrice:n.price_after_discount,sectionPosition:E.toString(),aboveFold:i,pageType:t,isSponsored:!0,contentId:n.content_id,subcontentId:n.subcontent_id,sellerDomain:n.seller,sellerName:n.brand,fullPrice:n.list_price})});let d=window.matchMedia("(prefers-color-scheme: dark)").matches,u=it(),p,g=Re;if(Yt(S,u),!Ge())return!1;let f={experience:"extension",subexperience:"precheckout"},{offers:m}=await pt(l,f,{returnRatesForShadowUsers:!0});if(L("offersRequest",r),!m||m.length===0)return b("noOffersAvailable"),!1;if(!We()){let n=bt.default.v4();m.forEach(E=>{E.href=E.href.replace(xe,n)})}if(Qe())p="EMBEDDED_MULTI_OFFER_PD",await Ct(m,S,p,d,r);else if(Je())p="EMBEDDED_MULTI_OFFER_PD_BUTTON",await Ct(m,S,p,d,r);else{let{shouldFireHoldout:n}=await Ot(m);n&&h({name:we,type:d?"dm":null})}jt(m,u,g),ae("Popular products",Le),ae("More products",De),ae("Deals on \\w+",Me),$t(Ne)}else return!1;return!0}function jt(e,t,r){t.forEach((i,o)=>{let l=e.find(u=>u.key===o.toString());nt(o.toString()).forEach(async u=>{u.addEventListener("click",()=>{h({type:$,subType:r,redirect:!0,label:l?.tld??S[o]?.seller,clickId:I(),carouselPosition:o,itemName:S[o]?.title||"",hasOffer:!!l})})})})}function Yt(e,t){let r=(o,l)=>{o.forEach(d=>{if(d.isIntersecting){l.unobserve(d.target);let u=d.target.getAttribute("data-pla-slot-pos");if(!u)return;let p=e.find(g=>g.slot_position===u);if(!p)return;gt({sectionType:"sponsored_pla",sellerUrl:p.url,productTitle:p.title,productListPrice:p.price_after_discount,sectionPosition:u,aboveFold:"fully-above",pageType:"sponsoredProductsPage",isSponsored:!0,contentId:p.content_id,subcontentId:p.subcontent_id,sellerDomain:p.seller})}})},i=new IntersectionObserver(r,{threshold:1});t.forEach((o,l)=>{i.observe(o)})}function ae(e,t){st(e).forEach((i,o)=>{let l=i.querySelector(".gkQHve.SsM98d.RmEs5b")?.textContent;i.addEventListener("click",()=>{h({type:$,subType:t,redirect:!1,label:l,clickId:I(),carouselPosition:o,itemName:S[o]?.title||"",hasOffer:!1})})})}function $t(e){document.querySelectorAll("#taw a").forEach((r,i)=>{let o;o=r.querySelector("div.aFn4tc.DZm15c.MBeuO")?.textContent,o||(o=r.querySelector("div.CCgQ5.vCa9Yd.QfkTvb.N8QANc.MBeuO.Va3FIb.EE3Upf span")?.textContent),r.addEventListener("click",()=>{h({type:$,subType:e,redirect:!1,label:o,clickId:I(),carouselPosition:i,itemName:S[i]?.title||"",hasOffer:!1})})})}function qt(e){let t="unknown",r=window.innerHeight,{bottom:i,top:o}=e.getBoundingClientRect();return o>r?t="fully-beneath":i<r?t="fully-above":t="partial",t}async function St(){let e=document.querySelectorAll(Se),t=null;for(let r of e)if(t=r.querySelector(Oe),t)break;return t}async function Ot(e){let t=5,r=await St();return document.querySelectorAll(ve).length===2&&(t=3),r?await ct("mo")?(b("noInjectionThrottled"),h({type:Ke}),{maxOffers:t,shouldShow:!1,injectionElement:null,shouldFireHoldout:!1}):e.length<3?(b("noInjectionMinOfferMiss"),h({type:Ae}),{maxOffers:t,shouldShow:!1,injectionElement:null,shouldFireHoldout:!1}):!R()&&!te()?{maxOffers:t,shouldShow:!1,injectionElement:null,shouldFireHoldout:!0}:ze()?{maxOffers:t,shouldShow:!1,injectionElement:r,shouldFireHoldout:!0}:{maxOffers:t,shouldShow:!0,injectionElement:r,shouldFireHoldout:!1}:(k("Injection element not found, cannot inject multi-offer"),b("noInjectionElement"),h({type:Be}),{maxOffers:t,shouldShow:!1,injectionElement:null,shouldFireHoldout:!1})}function Gt({multiOfferSelector:e,injectionElement:t}){if(!e&&!t)return k("Multi-offer selector or injection element not provided"),"unknown";let r="unknown",i=window.innerHeight;if(e){let o=document.querySelector("._25pcmo");if(o){let{bottom:l,top:d}=o.getBoundingClientRect();d>i?r="fully-beneath":l<i?r="fully-above":r="partial"}}else if(t){let{bottom:l}=t.getBoundingClientRect(),d=l+440;l>i?r="fully-beneath":d<i?r="fully-above":r="partial"}return r}async function zt(e,t){let{contentId:r,subcontentId:i,redirectUrl:o,type:l,subType:d,redirect:u,label:p,clickId:g,itemName:f,hasOffer:m,offer:n}=e,E={type:l,subType:d,redirect:u,label:p,clickId:g,itemName:f,hasOffer:m,notification_offer_details:JSON.stringify({offerPosition:n?.position,offerProductSource:n?.productSource,rewardsRate:n?.rewardsRate,rewardsType:n?.rewardsType})},T={clickType:"multi_cta",clickSubtype:"product_click",sellerDomain:n?.tld,isRedirect:!0,contentId:r,subcontentId:i,rewardAmount:n?.rewardsRate,rewardType:n?.rewardsType,rewardSubtype:"elevated_rewards"};function v(){window.open(o,"_blank","noopener,noreferrer"),h(E),N(T)}function x(s){v()}b("offerClicked",[`tld:${w(n.tld)}`,`dark:${t}`]),R()||!te()?v():rt()?(h(E),N(T),Tt(n)):(Xe()||Ze()||et()||tt())&&(h(E),N(T),Te({url:o}),await ee({appName:"preCheckout",app:(0,le.jsx)(mt,{onActivated:x,offer:n})}))}async function Ct(e,t,r,i,o){let l=()=>{N({clickType:"multi_cta",clickSubtype:"dismiss",isRedirect:!1,contentId:t[0]?.content_id}),h({type:Fe,redirect:!1,label:He})},{shouldShow:d,injectionElement:u,maxOffers:p}=await Ot(e);if(!d||!u)return;let g=Gt({injectionElement:u});await ee({appName:"preCheckout",app:(0,le.jsx)(se,{offers:e,products:t,variant:r,dark:i,startTime:o,onDismiss:l,onOfferClick:m=>zt(m,i),verticalLocation:g,maxOffers:p}),mountClass:"_25pcmo",insertAfterElement:u,positionOnTop:!1}),A("track",ke,{name:at(r,i),verticalLocation:g})}async function yt(){await Vt()}document.readyState!=="loading"?yt():document.addEventListener("DOMContentLoaded",yt);
