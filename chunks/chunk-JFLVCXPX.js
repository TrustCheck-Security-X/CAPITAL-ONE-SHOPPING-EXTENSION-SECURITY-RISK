import{b as s,c as h}from"./chunk-QLZPWOED.js";import{g as d,h as f,l as u,o as l,t as g}from"./chunk-2WJMAHXV.js";var c="blocksNotification";function v({type:t,name:n,shouldSendTracking:o,propsData:a={}}){if(!o)return;let{name:e,...i}=a;r({extensionTrackingType:"page",name:n},{type:t,...i})}function k({type:t,name:n,shouldSendTracking:o,propsData:a={}}){o&&r({extensionTrackingType:"track",name:n},{type:t,...a})}function r({extensionTrackingType:t,name:n},...o){l(t,n,{view:c,type:"notification",...o.reduce((a,e)=>({...a,...e}),{})})}function E(t){return t&&"notificationName"in t}function m(t){if(E(t.data))return{type:t.type,view:t.data.notificationName||t.type,content:t.data.notificationContent,pageType:t.data.pageType}}function C(t,n){let o=t.data?.propsData?.shouldsendtracking,a=typeof o=="boolean"?o:!0;switch(t.type){case s.Destroy:n?.();break;case s.NotificationShow:{let e=t.data;a&&r({extensionTrackingType:"page",name:e?.notificationName||t.type},{...m(t),...e.propsData}),e.throttleDurationMs&&T(e.throttleKey??c);break}case s.NotificationDismiss:{let e=t.data;a&&r({extensionTrackingType:"track",name:"dismissNotification"},{...m(t),...e.propsData,dismissLabel:e.dismissLabel??""});break}case s.NotificationThrottled:{let e=t.data,i=!e.notificationContent;a&&i&&r({extensionTrackingType:"page",name:"blocksNotificationThrottled"},{...m(t),...e.propsData,meta:JSON.stringify({throttleKey:e.throttleKey??c,throttleOn:e.throttleOn,throttleDurationMs:e.throttleDurationMs})});break}case s.PageView:{let e=t.data;v({type:t.type,name:e?.name||e?.propsData?.name||t.type,shouldSendTracking:a,propsData:e?.propsData});break}case s.Custom:{let e=t.data,{click_event_name:i,...p}=e?.propsData||{};k({type:t.type,name:i||t.eventName||t.type,shouldSendTracking:a,propsData:p});break}}}async function W(t){switch(t.type){case h.CheckNotifThrottled:{let n=t.data;return D(n?.throttleDurationMs,n?.throttleKey)}}}function T(t){d({message:"saveThrottle",throttleKey:t})}function D(t,n){return d({message:"checkSavedThrottle",throttleDurationMs:t,throttleKey:n??c})}var F=async()=>{let t=null;try{t=(await chrome.storage.sync.get("profileId")).profileId}catch{console.error("could not get profileId from local storage")}let n=f.get(["session","id"]),o=f.get("siteAPIData"),a=o?.siteData?.cashback?.reward||{},e=(await g())?.pageType,i={domain:o?.tld,merchant:o?.vendorName,siteCurrency:o?.siteData?.merchantPage?.currency,pageType:e,siteReward:a},p={featureFlags:u(),profileId:t??void 0,id:n??void 0};return{host:i,user:p}};export{T as a,D as b,C as c,W as d,F as e};
